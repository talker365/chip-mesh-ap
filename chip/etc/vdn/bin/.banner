#!/bin/ash
source /etc/vdn/include/vdn.lib

flashFree=`df -h | grep rootfs | awk {'print $4'}`
tmpFree=`df -h | grep tmpfs | grep "/tmp" | awk {'print $4'}`
memFree=`cat /proc/meminfo | grep MemFree | awk {'print $2'}`
firmver=`cat /etc/mesh-release`
vdnver=`cat /etc/vdn-release`
nodename=`uname -n`
hardware=`/usr/local/bin/get_model`
address=`ifconfig | grep -m 1 "Mask:255.0.0.0" | cut -d ':' -f2 | cut -d 'B' -f1`
ssid=`grep ssid /etc/config/wireless | cut -d '"' -f2`
channel=`uci get wireless.radio0.channel`
power=`iwinfo | grep -m 1 Tx-Power: | cut -d 'L' -f1 | cut -d ':' -f2 | tail -1`
bw=`uci get wireless.radio0.chanbw`
distance=`uci get wireless.radio0.distance`
loaded=`date +"[ %m/%d/%Y - %H:%M %Z ]"`

if [ -f "/www/AREDN.png" ]; then
   fw_mfg="AREDN"
fi
clear
echo -e ${GREEN}
echo -e "              _____  ______ _____  _   _              " 
echo -e "        /\   |  __ \|  ____|  __ \| \ | |TM           " 
echo -e "       /  \  | |__) | |__  | |  | |  \| |             " 
echo -e "      / /\ \ |  _  /|  __| | |  | | . ' |             " 
echo -e "     / ____ \| | \ \| |____| |__| | |\  |             " 
echo -e "    /_/    \_\_|  \_\______|_____/|_| \_|             " 
echo -e "    AMATEUR RADIO EMERGENCY DATA NETWORK             " 
echo -e ${NORMAL}" ----------------[ ${MAGENTA}$firmver${NORMAL} ]-----------------"
echo -e "${BOLD}${YELLOW}  $hardware ${GREEN} $nodename ${CYAN} $address${NORMAL} "
echo -e "${CYAN}${BOLD}  $ssid  ${CYAN}CH: $channel @$power$distance meters${NORMAL}"                                 		 
echo -e "  ${BOLD}${UNDERLINE}${YELLOW}Free Space:${NORMAL}"
echo -e "  flash  = ${CYAN}$flashFree${NORMAL} /temp  = ${CYAN}$tmpFree${NORMAL} Memory = ${CYAN}$memFree${NORMAL} KB"
echo -e "${GREEN}  Build: ${WHITE}${BLUE_B}$vdnver ${NORMAL}             "
echo -e "  Last Updated: "$loaded                              
echo -e " ---------------------------------------------"

