#!/bin/bash

#  Usage:  get_olsr neighbors|topology [html]
#  Example:  get_olsr topology
#            get_olsr neighbors html


INPUT_TYPE=$1
INPUT_FORMAT=""

case "$1" in

neighbors)
    echo "Getting list for neighbors"
    ;;  
topology)
    echo "Getting list for topology"
    ;;  
*)
    echo "Usage:  get_olsr neighbors|topology [html]"
    echo "Example:  get_olsr topology"
    echo "          get_olsr neighbors html"
    exit
   ;;  
esac


if [ -f /var/www/tmp/$1 ]; then rm /var/www/tmp/$1; fi; 
if [ -f /var/www/tmp/$1\.tmp ]; then rm /var/www/tmp/$1\.tmp; fi; 

wget -q -O /var/www/tmp/$1\.tmp  http://127.0.0.1:2006/$1
tail -n +3 /var/www/tmp/$1\.tmp | head -n -1 - >> /var/www/tmp/$1

if [ -f /var/www/tmp/$1\.tmp ]; then rm /var/www/tmp/$1\.tmp; fi; 
if [ -f /var/www/tmp/olsr.$1 ]; then rm /var/www/tmp/olsr.$1; fi; 

while read IP SYM MPR MPRS WILL TWOHOPS ; do
    cat /etc/hosts | grep "$IP" | grep -v "dtdlink." | grep -v "mid1." >> /var/www/tmp/olsr.$1
done < /var/www/tmp/$1

if [ -f /var/www/tmp/$1 ]; then rm /var/www/tmp/$1; fi; 

cat /var/www/tmp/olsr.$1

if [ -f /var/www/tmp/olsr.$1 ]; then rm /var/www/tmp/olsr.$1; fi; 

