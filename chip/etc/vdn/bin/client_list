#!/bin/bash
# Do not edit this file as it is being used in VDN MicroMesh Webpage.
# All connected wifi devices, with IP address,"
if [[ "$1" == "html" ]]; then
	echo -e "<table><thead><th>IP Address</th><th>Lease Name</th><th>MAC Address</th></thead><tbody>"
else
	printf  "# %-20s %-30s %-20s\n" "IP address" "Lease name" "MAC address"
fi

# Check for leases.
leasefile=/var/lib/misc/dnsmasq.leases

# Lets include client list on all used interfaces.
for interface in `iw dev | grep Interface | cut -f 2 -s -d" "`
do
  maclist=`iw dev $interface station dump | grep Station | cut -f 2 -s -d" "`

  for mac in $maclist
  do
    # If a DHCP lease has been given out by dnsmasq, lets save it
    ip="UnKnown"
    host=""
    ip=`cat $leasefile | cut -f 2,3,4 -s -d" " | grep $mac | cut -f 2 -s -d" "`
    host=`cat $leasefile | cut -f 2,3,4 -s -d" " | grep $mac | cut -f 3 -s -d" "`
	if [[ "$1" == "html" ]]; then
		echo -e "<tr><td>$ip</td><td>$host</td><td>$mac</td></tr>"
	else
    	printf "  %-20s %-30s %-20s\n" $ip $host $mac
	fi
  done
done

if [[ "$1" == "html" ]]; then
	echo -e "</tbody></table>"
fi
