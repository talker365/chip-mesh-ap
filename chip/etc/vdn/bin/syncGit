#!/bin/bash
# Look for arguments
if [ $# -eq 0 ]
then
    echo -e "\nNo arguments supplied !\n"
    echo -e "Example: ${0##*/} branch/folder\n"
    exit 1
fi

GH="https://github.com/talker365/chip-mesh-ap.git/"
IN=$1
IN=${IN##$GH}
BRANCH="trunk"
FOLDER=""

function checkSVN(){
    # Lets see if Subversion is installed.
    
    which svn > /dev/null
    if [ $? -eq 1 ]; then
        echo "Subversion was not found."
        echo "Installing Subversion !"
        apt-get install subversion -y
    fi
}


function testGit() {
    git branch
    
    if [ "$?" -ne 0 ]; then
        echo "[ERROR] Unable to read from $GH"
        exit 1;
    fi
}

testGit
checkSVN

IFS="/" read -a SECT <<< "$IN"

if [[ "${SECT[0]}" != "master" ]]; then
   BRANCH="branches/${SECT[0]}"
else
   BRANCH="trunk"
fi

for index in "${!SECT[@]}"; do
  if [ $index -gt 1 ]; then
    FOLDER=$FOLDER/${SECT[index]}
  fi
done

echo Exporting $GH$BRANCH/${SECT[1]}$FOLDER

svn --force export $GH$BRANCH/${SECT[1]}$FOLDER
